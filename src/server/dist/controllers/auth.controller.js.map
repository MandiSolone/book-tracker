{"version":3,"file":"auth.controller.js","names":["query","googleAuthCallback","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","accessToken","refreshToken","profile","done","userEmail","results","newUser","insertedUser","wrap","_callee$","_context","prev","next","emails","value","sent","length","abrupt","email","name","displayName","t0","stop","_x","_x2","_x3","_x4","apply","arguments","serializeUser","user","id","deserializeUser","_ref2","_callee2","_callee2$","_context2","_x5","_x6"],"sources":["../../controllers/auth.controller.js"],"sourcesContent":["// query is mySQL db (local-dev or clear-heroku-production) \n// sending commands from google oauth to user table during sing in\nimport query from \"../db/utils.js\";\n\n// Google OAuth callback function\nexport const googleAuthCallback = async (\n  accessToken,\n  refreshToken,\n  profile,\n  done\n) => {\n  const userEmail = profile.emails[0].value;\n\n  try {\n    // Check if user exists\n    const results = await query(\"SELECT * FROM users WHERE email = ?\", [\n      userEmail,\n    ]);\n\n    if (results.length > 0) {\n      return done(null, results[0]);\n    } else {\n      const newUser = { email: userEmail, name: profile.displayName };\n      await query(\"INSERT INTO users SET ?\", newUser);\n      const insertedUser = await query(\"SELECT * FROM users WHERE email = ?\", [\n        userEmail,\n      ]);\n      return done(null, insertedUser[0]);\n    }\n  } catch (err) {\n    return done(err);\n  }\n};\n\n// Serialize and deserialize user functions exported\nexport const serializeUser = (user, done) => {\n  done(null, user.id); // Use user.id to identify the user\n};\n\nexport const deserializeUser = async (id, done) => {\n  try {\n    const user = await query(\"SELECT * FROM users WHERE id = ?\", [id]);\n    done(null, user[0]); // Pass the user object to the session\n  } catch (err) {\n    done(err);\n  }\n};\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"auth.routes.js","names":["express","passport","AuthRouter","Router","redirectUrl","process","env","CLIENT_URL","get","authenticate","scope","failureRedirect","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","req","res","wrap","_callee$","_context","prev","next","console","log","user","error","abrupt","redirect","session","stop","_x","_x2","apply","arguments","_ref2","_callee2","_callee2$","_context2","REACT_APP_API_URL","method","url","isAuthenticated","userId","json","warn","status","message","_x3","_x4","post","logout","err"],"sources":["../../routes/auth.routes.js"],"sourcesContent":["// Using Google OAuth to sign in\nimport express from \"express\";\nimport passport from \"passport\"; // Used Passport Library - middleware for handling authentication\n\nconst AuthRouter = express.Router();\n\nconst redirectUrl = process.env.CLIENT_URL || \"http://localhost:8080/\"; // Use the environment variable\n\n// Redirect to Google for authentication\nAuthRouter.get(\n  \"/google\",\n  passport.authenticate(\"google\", {\n    scope: [\"profile\", \"email\"],\n  })\n);\n\n// Callback route for Google to redirect to\nAuthRouter.get(\n  \"/google/callback\",\n  passport.authenticate(\"google\", { failureRedirect: \"/\" }),\n  async (req, res) => {\n    console.log(\"google/callback Authenticated User:\", req.user);\n    if (!req.user) {\n      console.error(\"google/callback Authentication failed, no user returned.\");\n      return res.redirect(\"/\"); // Redirect if authentication fails\n    }\n    console.log(\"google/callback User session:\", { session: req.session });\n\n    res.redirect(redirectUrl); // Redirect to the account/home page (Client side) after auth\n  }\n);\n\n// User profile route\n// AuthRouter.get('/profile',\n//     passport.authenticate('session'), // Ensure user is authenticated\n//     async (req, res) => {\nAuthRouter.get(\"/profile\", async (req, res) => {\n  console.log(\n    \"UserProfileContext.js - REACT_APP_API_URL:\",\n    process.env.REACT_APP_API_URL\n  );\n  console.log(\"/profile - Incoming request:\", req.method, req.url);\n  console.log(\"/profile - User Session:\", req.session); // Log session info\n  console.log(\"/profile - User Authenticated:\", req.isAuthenticated()); // Log authentication status\n  console.log(\"/profile - Session Data:\", {\n    userId: req.session.passport ? req.session.passport.user : null,\n  });\n\n  if (req.isAuthenticated()) {\n    res.json(req.user); // Return the authenticated user\n  } else {\n    console.warn(\"/profile - User not authenticated, sending 401 response\");\n    res.status(401).json({ message: \"User not authenticated\" });\n  }\n});\n\n// Logout endpoint\nAuthRouter.post(\"/logout\", (req, res) => {\n  req.logout((err) => {\n    if (err) return next(err);\n    req.session = null; // Clear session data\n    res.redirect(\"/loggedout\"); // Redirect after logout\n  });\n});\n\nexport default AuthRouter;\n"],"mappings":"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","ignoreList":[]}
{"version":3,"file":"auth.routes.js","names":["express","passport","AuthRouter","Router","redirectUrl","process","env","CLIENT_URL","get","authenticate","scope","failureRedirect","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","req","res","wrap","_callee$","_context","prev","next","console","log","user","error","abrupt","redirect","session","stop","_x","_x2","apply","arguments","_ref2","_callee2","_callee2$","_context2","method","url","isAuthenticated","userId","json","warn","status","message","_x3","_x4","post","logout","err"],"sources":["../../routes/auth.routes.js"],"sourcesContent":["// Using Google OAuth to sign in \nimport express from \"express\";\nimport passport from \"passport\";// Used Passport Library - middleware for handling authentication\n\nconst AuthRouter = express.Router();\n\nconst redirectUrl = process.env.CLIENT_URL || 'http://localhost:8080/'; // Use the environment variable\n\n// Redirect to Google for authentication\nAuthRouter.get('/google', passport.authenticate('google', { \n    scope: ['profile', 'email'], \n    // prompt: 'select_account' // This will prompt the user to select an account each time they sign in \n}));\n\n// Callback route for Google to redirect to\nAuthRouter.get('/google/callback', \n    passport.authenticate('google', { failureRedirect: '/' }),\n    async (req, res) => {\n        console.log('google/callback Authenticated User:', req.user);\n        if (!req.user){\n            console.error('google/callback Authentication failed, no user returned.');\n            return res.redirect('/'); // Redirect if authentication fails\n        }\n        console.log('google/callback User session:', {\n            // store: sessionStore //not defined here \n            session: req.session, \n            passport: req.session.passport,\n        }); // Log session data\n        res.redirect(redirectUrl); // Redirect to the account/home page (Client side) after auth\n    }\n);\n\n// User profile route\nAuthRouter.get('/profile',\n    passport.authenticate('session'), // Ensure user is authenticated\n    async (req, res) => {\n    console.log('/profile - Incoming request:', req.method, req.url);\n    console.log('/profile - User Session:', req.session); // Log session info\n    console.log('/profile - User Authenticated:', req.isAuthenticated()); // Log authentication status\n    console.log('/profile - Session Data:', {\n        userId: req.session.passport ? req.session.passport.user : null, // log user ID if available\n        // Optionally log other non-sensitive data\n    });\n\n    if (req.isAuthenticated()) {\n        console.log('/profile - Returning user data:', req.user); // Log user data\n        res.json(req.user); // Return the authenticated user\n    } else {\n        console.warn('/profile - User not authenticated, sending 401 response');\n        res.status(401).json({ message: 'User not authenticated' });\n    }\n});\n\n// Logout endpoint\nAuthRouter.post('/logout', (req, res) => {\n    req.logout((err) => {\n        if (err) return next(err);\n        req.session = null; // Clear session data\n        res.redirect('/loggedout'); // Redirect after logout\n    });\n});\n\nexport default AuthRouter;"],"mappings":"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","ignoreList":[]}